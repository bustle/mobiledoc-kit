<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>mobiledoc-kit</title><meta name="description" content="Documentation for mobiledoc-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">mobiledoc-kit</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>mobiledoc-kit </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#mobiledoc-kit" id="mobiledoc-kit" style="color: inherit; text-decoration: none;">
  <h1>Mobiledoc Kit</h1>
</a>
<p><a href="https://github.com/bustle/mobiledoc-kit/actions?query=workflow%3ACI"><img src="https://github.com/bustle/mobiledoc-kit/workflows/CI/badge.svg" alt="CI Build Status"></a></p>
<p><a href="https://saucelabs.com/u/mobiledoc-kit"><img src="https://saucelabs.com/browser-matrix/mobiledoc-kit.svg" alt="Sauce Test Status"></a></p>
<p><img src="https://bustle.github.io/mobiledoc-kit/demo/mobiledoc-logo-color-small.png" alt="Mobiledoc Logo"></p>
<p>Mobiledoc Kit is a framework-agnostic library for building WYSIWYG editors
supporting rich content via cards.</p>

<a href="#libraries" id="libraries" style="color: inherit; text-decoration: none;">
  <h2>Libraries</h2>
</a>
<p>This repository hosts the core Mobiledoc Kit library. If you want to use Mobiledoc Kit to <em>create a WYSIWYG editor</em> you have the following options:</p>
<table>
<thead>
<tr>
<th>Environment</th>
<th>Library</th>
</tr>
</thead>
<tbody><tr>
<td>Plain JavaScript</td>
<td><a href="https://github.com/bustle/mobiledoc-kit">mobiledoc-kit</a> (this repo)</td>
</tr>
<tr>
<td>Ember</td>
<td><a href="https://github.com/bustle/ember-mobiledoc-editor">ember-mobiledoc-editor</a></td>
</tr>
<tr>
<td>React</td>
<td><a href="https://github.com/upworthy/react-mobiledoc-editor">react-mobiledoc-editor</a></td>
</tr>
</tbody></table>
<p>If you only want to use the Mobiledoc-Kit runtime, for <em>rendering mobiledoc posts only</em> (not editing or creating them), you can use:</p>
<table>
<thead>
<tr>
<th>Output Format/Environment</th>
<th>Library</th>
</tr>
</thead>
<tbody><tr>
<td>Plain JavaScript In-Browser (DOM)</td>
<td><a href="https://github.com/bustle/mobiledoc-dom-renderer">mobiledoc-dom-renderer</a></td>
</tr>
<tr>
<td>Server-Side Rendering (HTML)</td>
<td>see <a href="https://github.com/bustle/mobiledoc-dom-renderer#rendering-html">mobiledoc-dom-renderer&#39;s Rendering HTML section</a></td>
</tr>
<tr>
<td>Server-Side Rendering (Text-only, e.g. SEO)</td>
<td><a href="https://github.com/bustle/mobiledoc-text-renderer">mobiledoc-text-renderer</a></td>
</tr>
<tr>
<td>In-Browser (DOM) Rendering, with Ember</td>
<td><a href="https://github.com/bustle/ember-mobiledoc-dom-renderer">ember-mobiledoc-dom-renderer</a></td>
</tr>
<tr>
<td>React Server and Browser Renderer</td>
<td><a href="https://github.com/dailybeast/mobiledoc-react-renderer">mobiledoc-react-renderer</a></td>
</tr>
<tr>
<td>ðŸ”® Render Mobiledoc as VDOM by passing React or React-like <code>createElement</code> function</td>
<td><a href="https://github.com/bustle/mobiledoc-vdom-renderer">mobiledoc-vdom-renderer</a></td>
</tr>
</tbody></table>
<p>Mobiledoc is a deliberately simple and terse format, and you are encouraged to write your own renderer if you have other target output formats (e.g., a PDF renderer, an iOS Native Views Renderer, etc.).</p>

<a href="#demo" id="demo" style="color: inherit; text-decoration: none;">
  <h2>Demo</h2>
</a>
<p>Try a demo at <a href="https://bustle.github.io/mobiledoc-kit/demo/">bustle.github.io/mobiledoc-kit/demo</a>.</p>

<a href="#api-documentation" id="api-documentation" style="color: inherit; text-decoration: none;">
  <h2>API Documentation</h2>
</a>
<p>API Documentation is <a href="http://bustle.github.io/mobiledoc-kit/demo/docs/">available online</a>.</p>

<a href="#intro-to-mobiledoc-kit" id="intro-to-mobiledoc-kit" style="color: inherit; text-decoration: none;">
  <h2>Intro to Mobiledoc Kit</h2>
</a>
<ul>
<li>Posts are serialized to a JSON format called <strong>Mobiledoc</strong> instead of to
HTML. Mobiledoc can be rendered for the web, mobile web, or in theory on any
platform. Mobiledoc is portable and fast.</li>
<li>The editor makes limited use of Content Editable, the siren-song of doomed
web editor technologies.</li>
<li>Mobiledoc is designed for <em>rich</em> content. We call rich sections of an
article &quot;cards&quot; and rich inline elements &quot;atoms&quot; and implementing a new one doesn&#39;t require an understanding
of Mobiledoc editor internals. Adding a new atom or card takes an afternoon, not several
days. To learn more, see the docs for
<strong><a href="https://github.com/bustle/mobiledoc-kit/blob/master/ATOMS.md">Atoms</a></strong>,
<strong><a href="https://github.com/bustle/mobiledoc-kit/blob/master/CARDS.md">Cards</a></strong>
and
<strong><a href="https://github.com/bustle/mobiledoc-kit/blob/master/RENDERERS.md">Mobiledoc Renderers</a></strong></li>
</ul>
<p>To learn more about the ideas behind Mobiledoc and the editor (note that the
editor used to be named Content-Kit), see these blog posts:</p>
<ul>
<li><a href="http://madhatted.com/2015/7/31/announcing-content-kit-and-mobiledoc">The Content-Kit announcement post</a>.</li>
<li><a href="https://medium.com/@bantic/building-content-kit-editor-on-contenteditable-99a94871c951">Building the Content-Kit Editor on Content Editable</a></li>
<li><a href="http://madhatted.com/2015/8/25/content-kit-programmatic-editing">Content-Kit: Programmatic Editing</a></li>
</ul>
<p>The Mobiledoc kit saves posts in
<strong><a href="https://github.com/bustle/mobiledoc-kit/blob/master/MOBILEDOC.md">Mobiledoc format</a></strong>.</p>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h3>Usage</h3>
</a>
<p>The <code>Mobiledoc.Editor</code> class is invoked with an element to render into and
optionally a Mobiledoc to load. For example:</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">simpleMobiledoc</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-3">version:</span><span class="hl-1"> </span><span class="hl-4">&quot;0.3.2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">markups:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  </span><span class="hl-3">atoms:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  </span><span class="hl-3">cards:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  </span><span class="hl-3">sections:</span><span class="hl-1"> [</span><br/><span class="hl-1">    [</span><span class="hl-5">1</span><span class="hl-1">, </span><span class="hl-4">&quot;p&quot;</span><span class="hl-1">, [</span><br/><span class="hl-1">      [</span><span class="hl-5">0</span><span class="hl-1">, [], </span><span class="hl-5">0</span><span class="hl-1">, </span><span class="hl-4">&quot;Welcome to Mobiledoc&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">    ]]</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">};</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">element</span><span class="hl-1"> = </span><span class="hl-3">document</span><span class="hl-1">.</span><span class="hl-6">querySelector</span><span class="hl-1">(</span><span class="hl-4">&#39;#editor&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">options</span><span class="hl-1"> = { </span><span class="hl-3">mobiledoc:</span><span class="hl-1"> </span><span class="hl-3">simpleMobiledoc</span><span class="hl-1"> };</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">editor</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Mobiledoc</span><span class="hl-1">.</span><span class="hl-6">Editor</span><span class="hl-1">(</span><span class="hl-3">options</span><span class="hl-1">);</span><br/><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">render</span><span class="hl-1">(</span><span class="hl-3">element</span><span class="hl-1">);</span>
</code></pre>
<p><code>options</code> is an object which may include the following properties:</p>
<ul>
<li><code>mobiledoc</code> - [object] A mobiledoc object to load and edit.</li>
<li><code>placeholder</code> - [string] default text to show before a user starts typing.</li>
<li><code>spellcheck</code> - [boolean] whether to enable spellcheck. Defaults to true.</li>
<li><code>autofocus</code> - [boolean] When true, focuses on the editor when it is rendered.</li>
<li><code>undoDepth</code> - [number] How many undo levels should be available. Default
value is five. Set this to zero to disable undo/redo.</li>
<li><code>cards</code> - [array] The list of cards that the editor may render</li>
<li><code>atoms</code> - [array] The list of atoms that the editor may render</li>
<li><code>cardOptions</code> - [object] Options passed to cards and atoms</li>
<li><code>unknownCardHandler</code> - [function] This will be invoked by the editor-renderer
whenever it encounters an unknown card</li>
<li><code>unknownAtomHandler</code> - [function] This will be invoked by the editor-renderer
whenever it encounters an unknown atom</li>
<li><code>parserPlugins</code> - [array] See <a href="https://github.com/bustle/mobiledoc-kit#dom-parsing-hooks">DOM Parsing Hooks</a></li>
<li><code>tooltipPlugin</code> - [object] Optional plugin for customizing tooltip appearance</li>
</ul>
<p>The editor leverages unicode characters, so HTML documents must opt in to
UTF8. For example this can be done by adding the following to an HTML
document&#39;s <code>&lt;head&gt;</code>:</p>
<pre><code class="language-html"><span class="hl-7">&lt;</span><span class="hl-8">meta</span><span class="hl-1"> </span><span class="hl-9">charset</span><span class="hl-1">=</span><span class="hl-10">&quot;utf-8&quot;</span><span class="hl-1"> </span><span class="hl-7">/&gt;</span>
</code></pre>

<a href="#editor-api" id="editor-api" style="color: inherit; text-decoration: none;">
  <h3>Editor API</h3>
</a>
<ul>
<li><code>editor.serialize(version=&quot;0.3.2&quot;)</code> - serialize the current post for persistence. Returns
Mobiledoc.</li>
<li><code>editor.destroy()</code> - teardown the editor event listeners, free memory etc.</li>
<li><code>editor.disableEditing()</code> - stop the user from being able to edit the
current post with their cursor. Programmatic edits are still allowed.</li>
<li><code>editor.enableEditing()</code> - allow the user to make edits directly
to a post&#39;s text.</li>
<li><code>editor.editCard(cardSection)</code> - change the card to its edit mode (will change
immediately if the card is already rendered, or will ensure that when the card
does get rendered it will be rendered in the &quot;edit&quot; state initially)</li>
<li><code>editor.displayCard(cardSection)</code> - same as <code>editCard</code> except in display mode.</li>
<li><code>editor.range</code> - Read the current Range object for the cursor.</li>
</ul>

<a href="#position-api" id="position-api" style="color: inherit; text-decoration: none;">
  <h3>Position API</h3>
</a>
<p>A <code>Position</code> object represents a location in a document. For example your
cursor may be at a position, text may be inserted at a position, and a range
has a starting position and an ending position.</p>
<p>Position objects are returned by several APIs, for example <code>deleteRange</code> returns
a position. Some methods, like <code>splitSection</code> accept a position as an argument.</p>
<p>A position can be created for any point in a document with
<code>section#toPosition(offset)</code>.</p>
<p>Position API includes:</p>
<ul>
<li><code>position.section</code> - The section of this position</li>
<li><code>position.offset</code> - The character offset of this position in the section.</li>
<li><code>position.marker</code> - Based on the section and offset, the marker this position
is on. A position may not always have a marker (for example a cursor before
or after a card).</li>
<li><code>position.toRange(endPosition)</code> - Create a range based on two positions. Accepts
the direction of the range as a second optional argument.</li>
<li><code>position.isEqual(otherPosition)</code> - Is this position the same as another</li>
<li><code>position.move(characterCount)</code> - Move a number of characters to the right
(positive number) or left (negative number)</li>
<li><code>position.moveWord(direction)</code> - Move a single word in a given direction.</li>
</ul>

<a href="#range-api" id="range-api" style="color: inherit; text-decoration: none;">
  <h3>Range API</h3>
</a>
<p><code>Range</code> represents a range of a document. A range has a starting position
(<code>head</code>), ending position (<code>tail</code>), and a direction (for example highlighting
text left-to-right is a forward direction, highlighting right-to-left is a
backward direction).</p>
<p>Ranges are returned by several APIs, but most often you will be interested in
the current range selected by the user (be it their cursor or an actual
selection). This can be accessed at <code>editor#range</code>. Several post editor APIs
expect a range as an argument, for example <code>setRange</code> or <code>deleteRange</code>.</p>
<p>Ranges sport several public APIs for manipulation, each of which returns a new,
unique range instance:</p>
<ul>
<li><code>range.head</code> - The position on the range closer to the start of the document.</li>
<li><code>range.tail</code> - The position on the range closer to the end of the document.</li>
<li><code>range.isCollapsed</code> - A range is collapsed when its head and tail are the same
position.</li>
<li><code>range.focusedPosition</code> - If a range has a forward direction, then tail. If
it has a backward direction, then head.</li>
<li><code>range.extend(characterCount)</code> - Grow a range one character in whatever its
direction is.</li>
<li><code>range.move(direction)</code> - If the range is collapsed, move the range forward
one character. If it is not, collapse it in the direction passed.</li>
<li><code>range.expandByMarker(callback)</code> - In both directions attempt grow the
range as long as <code>callback</code> returns true. <code>callback</code> is passed each marker
as the range is grown.</li>
</ul>

<a href="#editor-lifecycle-hooks" id="editor-lifecycle-hooks" style="color: inherit; text-decoration: none;">
  <h3>Editor Lifecycle Hooks</h3>
</a>
<p>API consumers may want to react to given interaction by the user (or by
a programmatic edit of the post). Lifecycle hooks provide notification
of change and opportunity to edit the post where appropriate.</p>
<p>Register a lifecycle hook by calling the hook name on the editor with a
callback function. For example:</p>
<pre><code class="language-js"><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">didUpdatePost</span><span class="hl-1">(</span><span class="hl-3">postEditor</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">let</span><span class="hl-1"> { </span><span class="hl-3">range</span><span class="hl-1"> } = </span><span class="hl-3">editor</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-3">cursorSection</span><span class="hl-1"> = </span><span class="hl-3">range</span><span class="hl-1">.</span><span class="hl-3">head</span><span class="hl-1">.</span><span class="hl-3">section</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-11">if</span><span class="hl-1"> (</span><span class="hl-3">cursorSection</span><span class="hl-1">.</span><span class="hl-3">text</span><span class="hl-1"> === </span><span class="hl-4">&#39;add-section-when-i-type-this&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-3">section</span><span class="hl-1"> = </span><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-3">builder</span><span class="hl-1">.</span><span class="hl-6">createMarkupSection</span><span class="hl-1">(</span><span class="hl-4">&#39;p&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">postEditor</span><span class="hl-1">.</span><span class="hl-6">insertSectionBefore</span><span class="hl-1">(</span><span class="hl-3">section</span><span class="hl-1">, </span><span class="hl-3">cursorSection</span><span class="hl-1">.</span><span class="hl-3">next</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">postEditor</span><span class="hl-1">.</span><span class="hl-6">setRange</span><span class="hl-1">(</span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Mobiledoc</span><span class="hl-1">.</span><span class="hl-6">Range</span><span class="hl-1">(</span><span class="hl-3">section</span><span class="hl-1">.</span><span class="hl-3">headPosition</span><span class="hl-1">));</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>The available lifecycle hooks are:</p>
<ul>
<li><code>editor.didUpdatePost(postEditor =&gt; {})</code> - An opportunity to use the
<code>postEditor</code> and possibly change the post before rendering begins.</li>
<li><code>editor.willRender()</code> - After all post mutation has finished, but before
 the DOM is updated.</li>
<li><code>editor.didRender()</code> - After the DOM has been updated to match the
edited post.</li>
<li><code>editor.willDelete((range, direction, unit))</code> - Provides <code>range</code>, <code>direction</code> and <code>unit</code> to identify the coming deletion.</li>
<li><code>editor.didDelete((range, direction, unit))</code> - Provides <code>range</code>, <code>direction</code> and <code>unit</code> to identify the completed deletion.</li>
<li><code>editor.cursorDidChange()</code> - When the cursor (or selection) changes as a result of arrow-key
movement or clicking in the document.</li>
<li><code>editor.onTextInput()</code> - When the user adds text to the document (see <a href="https://github.com/bustlelabs/mobiledoc-kit#responding-to-text-input">example</a>)</li>
<li><code>editor.inputModeDidChange()</code> - The active section(s) or markup(s) at the current cursor position or selection have changed. This hook can be used with <code>Editor#activeMarkups</code>, <code>Editor#activeSections</code>, and <code>Editor#activeSectionAttributes</code> to implement a custom toolbar.</li>
<li><code>editor.beforeToggleMarkup(({markup, range, willAdd}) =&gt; {...})</code> - Register a
callback that will be called before <code>editor#toggleMarkup</code> is applied. If any
callback returns literal <code>false</code>, the toggling of markup will be canceled.
(Toggling markup done via the postEditor, e.g. <code>editor.run(postEditor =&gt; postEditor.toggleMarkup(...))</code> will skip this callback.</li>
<li><code>editor.willCopy(({html, text, mobiledoc}) =&gt; {...})</code> - Called before the
serialized versions of the selected markup is copied to the system
pasteboard.
<code>editor.willPaste(({html, text, mobiledoc}) =&gt; {...})</code> - Called before the
serialized versions of the system pasteboard is pasted into the mobiledoc.</li>
</ul>
<p>For more details on the lifecycle hooks, see the <a href="https://bustle.github.io/mobiledoc-kit/demo/docs/Editor.html">Editor documentation</a>.</p>

<a href="#programmatic-post-editing" id="programmatic-post-editing" style="color: inherit; text-decoration: none;">
  <h3>Programmatic Post Editing</h3>
</a>
<p>A major goal of the Mobiledoc kit is to allow complete customization of user
interfaces using the editing surface. The programmatic editing API allows
the creation of completely custom interfaces for buttons, hot-keys, and
other interactions.</p>
<p>To change the post in code, use the <code>editor.run</code> API. For example, the
following usage would mark currently selected text as &quot;strong&quot;:</p>
<pre><code class="language-js"><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">run</span><span class="hl-1">(</span><span class="hl-3">postEditor</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">postEditor</span><span class="hl-1">.</span><span class="hl-6">toggleMarkup</span><span class="hl-1">(</span><span class="hl-4">&#39;strong&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>
<p>It is important that you make changes to posts, sections, and markers through
the <code>run</code> and <code>postEditor</code> API. This API allows the Mobiledoc editor to conserve
and better understand changes being made to the post.</p>
<pre><code class="language-js"><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">run</span><span class="hl-1">(</span><span class="hl-3">postEditor</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">mention</span><span class="hl-1"> = </span><span class="hl-3">postEditor</span><span class="hl-1">.</span><span class="hl-3">builder</span><span class="hl-1">.</span><span class="hl-6">createAtom</span><span class="hl-1">(</span><span class="hl-4">&quot;mention&quot;</span><span class="hl-1">, </span><span class="hl-4">&quot;Jane Doe&quot;</span><span class="hl-1">, { </span><span class="hl-3">id:</span><span class="hl-1"> </span><span class="hl-5">42</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-12">// insert at current cursor position:</span><br/><span class="hl-1">  </span><span class="hl-12">// or should the user have to grab the current position from the editor first?</span><br/><span class="hl-1">  </span><span class="hl-3">postEditor</span><span class="hl-1">.</span><span class="hl-6">insertMarkers</span><span class="hl-1">(</span><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-3">range</span><span class="hl-1">.</span><span class="hl-3">head</span><span class="hl-1">, [</span><span class="hl-3">mention</span><span class="hl-1">]);</span><br/><span class="hl-1">});</span>
</code></pre>
<p>For more details on the API of <code>postEditor</code>, see the <a href="https://github.com/bustle/mobiledoc-kit/blob/master/src/js/editor/post.js">API documentation</a>.</p>
<p>For more details on the API for the builder, required to create new sections
atoms, and markers, see the <a href="https://github.com/bustle/mobiledoc-kit/blob/master/src/js/models/post-node-builder.js">builder API</a>.</p>

<a href="#configuring-hot-keys" id="configuring-hot-keys" style="color: inherit; text-decoration: none;">
  <h3>Configuring hot keys</h3>
</a>
<p>The Mobiledoc editor allows the configuration of hot keys and text expansions.
For instance, the hot-key command-B to make selected text bold, is registered
internally as:</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">boldKeyCommand</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-3">str:</span><span class="hl-1"> </span><span class="hl-4">&#39;META+B&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">run</span><span class="hl-1">(</span><span class="hl-3">editor</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">run</span><span class="hl-1">(</span><span class="hl-3">postEditor</span><span class="hl-1"> </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">postEditor</span><span class="hl-1">.</span><span class="hl-6">toggleMarkup</span><span class="hl-1">(</span><span class="hl-4">&#39;strong&#39;</span><span class="hl-1">));</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span><br/><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">registerKeyCommand</span><span class="hl-1">(</span><span class="hl-3">boldKeyCommand</span><span class="hl-1">);</span>
</code></pre>
<p>All key commands must have <code>str</code> and <code>run</code> properties as shown above.</p>
<p><code>str</code> describes the key combination to use and may be a single key, or modifier(s) and a key separated by <code>+</code>, e.g.: <code>META+K</code> (cmd-K), <code>META+SHIFT+K</code> (cmd-shift-K)</p>
<p>Modifiers can be any of <code>CTRL</code>, <code>META</code>, <code>SHIFT</code>, or <code>ALT</code>.</p>
<p>The key can be any of the alphanumeric characters on the keyboard, or one of the following special keys:</p>
<p><code>BACKSPACE</code>, <code>TAB</code>, <code>ENTER</code>, <code>ESC</code>, <code>SPACE</code>, <code>PAGEUP</code>, <code>PAGEDOWN</code>, <code>END</code>, <code>HOME</code>, <code>LEFT</code>, <code>UP</code>, <code>RIGHT</code>, <code>DOWN</code>, <code>INS</code>, <code>DEL</code></p>

<a href="#overriding-built-in-keys" id="overriding-built-in-keys" style="color: inherit; text-decoration: none;">
  <h4>Overriding built-in keys</h4>
</a>
<p>You can override built-in behavior by simply registering a hot key with the same name.
For example, to submit a form instead of entering a new line when <code>enter</code> is pressed you could do the following:</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">enterKeyCommand</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-3">str:</span><span class="hl-1"> </span><span class="hl-4">&#39;enter&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">run</span><span class="hl-1">(</span><span class="hl-3">editor</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-12">// submit the form</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span><br/><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">registerKeyCommand</span><span class="hl-1">(</span><span class="hl-3">enterKeyCommand</span><span class="hl-1">);</span>
</code></pre>
<p>To fall-back to the default behavior, return <code>false</code> from <code>run</code>.</p>

<a href="#responding-to-text-input" id="responding-to-text-input" style="color: inherit; text-decoration: none;">
  <h3>Responding to text input</h3>
</a>
<p>The editor exposes a hook <code>onTextInput</code> that can be used to programmatically react
to text that the user enters. Specify a handler object with <code>text</code> or <code>match</code>
properties and a <code>run</code> callback function, and the editor will invoke the callback
when the text before the cursor ends with <code>text</code> or matches <code>match</code>.
The callback is called after the matching text has been inserted. It is passed
the <code>editor</code> instance and an array of matches (either the result of <code>match.exec</code>
on the matching user-entered text, or an array containing only the <code>text</code>).</p>
<pre><code class="language-js"><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">onTextInput</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">text:</span><span class="hl-1"> </span><span class="hl-4">&#39;X&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">run</span><span class="hl-1">(</span><span class="hl-3">editor</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-12">// This callback is called after user types &#39;X&#39;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">onTextInput</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">match:</span><span class="hl-13"> /\d\dX</span><span class="hl-14">$</span><span class="hl-13">/</span><span class="hl-1">,  </span><span class="hl-12">// Note the &quot;$&quot; end anchor</span><br/><span class="hl-1">  </span><span class="hl-6">run</span><span class="hl-1">(</span><span class="hl-3">editor</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-12">// This callback is called after user types number-number-X</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>The editor has several default text input handlers that are defined in
<code>src/js/editor/text-input-handlers.js</code>.</p>
<p>To remove default text input handlers call the unregister function.</p>
<pre><code class="language-js"><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">unregisterAllTextInputHandlers</span><span class="hl-1">();</span>
</code></pre>

<a href="#n-special-case-match-character" id="n-special-case-match-character" style="color: inherit; text-decoration: none;">
  <h4><code>\n</code> special-case match character</h4>
</a>
<p>When writing a matching string it is common to use <code>\s</code> at the end of a match
regex, thus triggering the handler for a given string when the users presses
the space or tab key.</p>
<p>When the enter key is pressed no actual characters are added to a document.
Instead a new section is created following the current section. Despite this,
you may use <code>\n</code> in a match regex to capture moments when the enter key is
pressed. For example if you wanted to process a URL for auto-linking you
might want to process the string on both the space key and when the user hits
enter.</p>
<p>Since <code>\s</code> is a superset of <code>\n</code>, that makes the following regex a valid match
for a hand-typed URL after the user presses space or enter:</p>
<pre><code class="language-regex">/\b(https?:\/\/[^\s]+)\s$/
</code></pre>

<a href="#dom-parsing-hooks" id="dom-parsing-hooks" style="color: inherit; text-decoration: none;">
  <h3>DOM Parsing hooks</h3>
</a>
<p>A developer can override the default parsing behavior for leaf DOM nodes in
pasted HTML.</p>
<p>For example, when an <code>img</code> tag is pasted it may be appropriate to
fetch that image, upload it to an authoritative source, and create a specific
kind of image card with the new URL in its payload.</p>
<p>A demonstration of this:</p>
<pre><code class="language-js"><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-6">imageToCardParser</span><span class="hl-1">(</span><span class="hl-3">node</span><span class="hl-1">, </span><span class="hl-3">builder</span><span class="hl-1">, {</span><span class="hl-3">addSection</span><span class="hl-1">, </span><span class="hl-3">addMarkerable</span><span class="hl-1">, </span><span class="hl-3">nodeFinished</span><span class="hl-1">}) {</span><br/><span class="hl-1">  </span><span class="hl-11">if</span><span class="hl-1"> (</span><span class="hl-3">node</span><span class="hl-1">.</span><span class="hl-3">nodeType</span><span class="hl-1"> !== </span><span class="hl-5">1</span><span class="hl-1"> || </span><span class="hl-3">node</span><span class="hl-1">.</span><span class="hl-3">tagName</span><span class="hl-1"> !== </span><span class="hl-4">&#39;IMG&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-11">return</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">payload</span><span class="hl-1"> = { </span><span class="hl-3">src:</span><span class="hl-1"> </span><span class="hl-3">node</span><span class="hl-1">.</span><span class="hl-3">src</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">cardSection</span><span class="hl-1"> = </span><span class="hl-3">builder</span><span class="hl-1">.</span><span class="hl-6">createCardSection</span><span class="hl-1">(</span><span class="hl-4">&#39;my-image&#39;</span><span class="hl-1">, </span><span class="hl-3">payload</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">addSection</span><span class="hl-1">(</span><span class="hl-3">cardSection</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">nodeFinished</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">options</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-3">parserPlugins:</span><span class="hl-1"> [</span><span class="hl-3">imageToCardParser</span><span class="hl-1">]</span><br/><span class="hl-1">};</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">editor</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Mobiledoc</span><span class="hl-1">.</span><span class="hl-6">Editor</span><span class="hl-1">(</span><span class="hl-3">options</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">element</span><span class="hl-1"> = </span><span class="hl-3">document</span><span class="hl-1">.</span><span class="hl-6">querySelector</span><span class="hl-1">(</span><span class="hl-4">&#39;#editor&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">render</span><span class="hl-1">(</span><span class="hl-3">element</span><span class="hl-1">);</span>
</code></pre>
<p>Parser hooks are called with three arguments:</p>
<ul>
<li><code>node</code> - The node of DOM being parsed. This may be a text node or an element.</li>
<li><code>builder</code> - The abstract model builder.</li>
<li><code>env</code> - An object containing three callbacks to modify the abstract<ul>
<li><code>addSection</code> - Close the current section and add a new one</li>
<li><code>addMarkerable</code> - Add a markerable (marker or atom) to the current section</li>
<li><code>nodeFinished</code> - Bypass all remaining parse steps for this node</li>
</ul>
</li>
</ul>
<p>Note that you <em>must</em> call <code>nodeFinished</code> to stop a DOM node from being
parsed by the next plugin or the default parser.</p>

<a href="#tooltip-plugins" id="tooltip-plugins" style="color: inherit; text-decoration: none;">
  <h3>Tooltip Plugins</h3>
</a>
<p>Developers can customize the appearance of tooltips (e.g. those shown when a user hovers over a link element) by specificying a tooltip plugin. A tooltip plugin is an object that implements the <code>renderLink</code> method.</p>
<p>The <code>renderLink</code> method is called with three arguments:</p>
<ul>
<li><code>tooltip</code> - The DOM element of the tooltip UI.</li>
<li><code>link</code> - The DOM element (HTMLAnchorElement) of the link to display a tooltip for.</li>
<li><code>actions</code> - An object containing functions that can be called in response to user interaction.<ul>
<li><code>editLink</code> - A function that, when called, prompts the user to edit the <code>href</code> of the link element in question.</li>
</ul>
</li>
</ul>
<p>The <code>renderLink</code> method is responsible for populating the passed <code>tooltip</code> element with the correct content to display to the user based on the link in question. This allows Mobiledoc users to, for example, provide localized tooltip text via their system of choice.</p>
<pre><code class="language-js"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">MyTooltip</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-6">renderLink</span><span class="hl-1">(</span><span class="hl-3">tooltip</span><span class="hl-1">, </span><span class="hl-3">link</span><span class="hl-1">, { </span><span class="hl-3">editLink</span><span class="hl-1"> }) {</span><br/><span class="hl-1">    </span><span class="hl-3">tooltip</span><span class="hl-1">.</span><span class="hl-3">innerHTML</span><span class="hl-1"> = </span><span class="hl-4">`</span><span class="hl-0">${</span><span class="hl-3">i18n</span><span class="hl-15">.</span><span class="hl-6">translate</span><span class="hl-15">(</span><span class="hl-4">&#39;URL: &#39;</span><span class="hl-15">)</span><span class="hl-0">}</span><span class="hl-4"> </span><span class="hl-0">${</span><span class="hl-3">link</span><span class="hl-15">.</span><span class="hl-3">href</span><span class="hl-0">}</span><span class="hl-4">`</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">button</span><span class="hl-1"> = </span><span class="hl-3">document</span><span class="hl-1">.</span><span class="hl-6">createElement</span><span class="hl-1">(</span><span class="hl-4">&#39;button&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">button</span><span class="hl-1">.</span><span class="hl-3">innerText</span><span class="hl-1"> = </span><span class="hl-3">i18n</span><span class="hl-1">.</span><span class="hl-6">translate</span><span class="hl-1">(</span><span class="hl-4">&#39;Edit&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">button</span><span class="hl-1">.</span><span class="hl-6">addEventListener</span><span class="hl-1">(</span><span class="hl-4">&#39;click&#39;</span><span class="hl-1">, </span><span class="hl-3">editLink</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">tooltip</span><span class="hl-1">.</span><span class="hl-6">append</span><span class="hl-1">(</span><span class="hl-3">button</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">editor</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Mobiledoc</span><span class="hl-1">.</span><span class="hl-6">Editor</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">tooltipPlugin:</span><span class="hl-1"> </span><span class="hl-3">MyTooltip</span><br/><span class="hl-1">});</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">element</span><span class="hl-1"> = </span><span class="hl-3">document</span><span class="hl-1">.</span><span class="hl-6">querySelector</span><span class="hl-1">(</span><span class="hl-4">&#39;#editor&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">editor</span><span class="hl-1">.</span><span class="hl-6">render</span><span class="hl-1">(</span><span class="hl-3">element</span><span class="hl-1">);</span>
</code></pre>

<a href="#contributing" id="contributing" style="color: inherit; text-decoration: none;">
  <h2>Contributing</h2>
</a>
<p>Fork the repo, write a test, make a change, open a PR.</p>

<a href="#tests-linting-formatting" id="tests-linting-formatting" style="color: inherit; text-decoration: none;">
  <h3>Tests, Linting, Formatting</h3>
</a>
<p>Install dependencies via yarn:</p>
<ul>
<li><a href="http://nodejs.org/">Node.js</a> is required</li>
<li>Install <a href="https://yarnpkg.com/en/docs/install">yarn</a> globally: <code>npm install -g yarn</code> or <code>brew install yarn</code></li>
<li>Install dependencies with yarn: <code>yarn install</code></li>
</ul>
<p>Run tests via the built-in broccoli server:</p>
<ul>
<li><code>yarn start</code></li>
<li><code>open http://localhost:4200/tests</code></li>
</ul>
<p>Or run headless tests via testem:</p>
<ul>
<li><code>yarn test</code></li>
</ul>
<p>Tests in CI are run at Github Actions via Saucelabs (see the <code>test:ci</code> yarn script).</p>
<p>Run linter</p>
<ul>
<li><code>yarn lint</code></li>
</ul>
<p>Run formatting</p>
<ul>
<li><code>yarn format</code></li>
</ul>

<a href="#demo-1" id="demo-1" style="color: inherit; text-decoration: none;">
  <h3>Demo</h3>
</a>
<p>To run the demo site locally:</p>
<ul>
<li><code>yarn start</code></li>
<li><code>open http://localhost:4200/website/demo/</code></li>
</ul>
<p>The assets for the demo are in <code>assets/demo</code>.</p>

<a href="#debugging" id="debugging" style="color: inherit; text-decoration: none;">
  <h3>Debugging</h3>
</a>
<p>A debugging environment that prints useful information about the active Mobiledoc editor
can be access by:</p>
<ul>
<li><code>yarn start</code></li>
<li><code>open http://localhost:4200/website/demo/debug.html</code></li>
</ul>

<a href="#getting-help" id="getting-help" style="color: inherit; text-decoration: none;">
  <h3>Getting Help</h3>
</a>
<p>If you notice a bug or have a feature request please <a href="https://github.com/bustle/mobiledoc-kit/issues">open an issue on github</a>.
If you have a question about usage you can post in the <a href="https://mobiledoc-kit.slack.com/">slack channel</a> (automatic invites available from our <a href="https://mobiledoc-slack.herokuapp.com/">slackin app</a>) or on StackOverflow using the <a href="http://stackoverflow.com/questions/tagged/mobiledoc-kit"><code>mobiledoc-kit</code> tag</a>.</p>

<a href="#releasing-implementer-notes" id="releasing-implementer-notes" style="color: inherit; text-decoration: none;">
  <h3>Releasing (Implementer notes)</h3>
</a>
<ul>
<li>Use <code>np</code> (<code>yarn install -g np</code>)</li>
<li><code>np &lt;version&gt;</code> (e.g. <code>np 0.12.0</code>)</li>
<li><code>git push &lt;origin&gt; --tags</code></li>
</ul>

<a href="#deploy-the-demo" id="deploy-the-demo" style="color: inherit; text-decoration: none;">
  <h3>Deploy the demo</h3>
</a>
<p>The demo website is hosted at
<a href="https://bustle.github.io/mobiledoc-kit/demo">bustle.github.io/mobiledoc-kit/demo</a>.</p>
<p>To preview the website, start the server and visit
<a href="http://localhost:4200/assets/demo/">http://localhost:4200/assets/demo/</a>. The code for
this website can be found in <code>assets/demo/</code>. Note that the development server
does not rebuild docs.</p>
<p>To publish a new version:</p>
<ul>
<li><code>yarn run build:website</code> - This builds the website into <code>website/</code> and commits it</li>
<li><code>yarn run deploy:website</code> - Pushes the <code>website/</code> subtree to the <code>gh-pages</code>
 branch of your <code>origin</code> at github</li>
</ul>
<p><em>Development of Mobiledoc and the supporting libraries was generously funded by <a href="https://bustle.company/">Bustle Digital Group</a>.</em></p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/Editor.html" class="tsd-kind-icon">Editor</a></li><li class="tsd-kind-class"><a href="classes/Position.html" class="tsd-kind-icon">Position</a></li><li class="tsd-kind-class"><a href="classes/PostNodeBuilder.html" class="tsd-kind-icon">Post<wbr/>Node<wbr/>Builder</a></li><li class="tsd-kind-class"><a href="classes/Range.html" class="tsd-kind-icon">Range</a></li><li class="tsd-kind-variable"><a href="modules.html#ImageCard" class="tsd-kind-icon">Image<wbr/>Card</a></li><li class="tsd-kind-variable"><a href="modules.html#MOBILEDOC_VERSION" class="tsd-kind-icon">MOBILEDOC_<wbr/>VERSION</a></li><li class="tsd-kind-variable"><a href="modules.html#Renderer" class="tsd-kind-icon">Renderer</a></li><li class="tsd-kind-variable"><a href="modules.html#UI" class="tsd-kind-icon">UI</a></li><li class="tsd-kind-variable"><a href="modules.html#VERSION" class="tsd-kind-icon">VERSION</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li><li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>